import{d as H,r as m,o as K,C as se,w as O,a as A,c as x,_ as le,u as ne,b as z,e as ce,f as e,g as R,h as W,v as L,t as d,i as C,j as ie,F as Z,k as q,p as re,l as de,m as b,n as ue}from"./index.4b015a66.js";const pe={alta:-15,nessuna:0,leggera:25,pesante:50},G=H({__name:"BarChart",props:{data:null},setup(w){const g=w,i=m(void 0);let r;return K(()=>{if(i.value===void 0)return;const _="#E3E3E3",v="#464646";r=new se(i.value,{type:"bar",data:{labels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],datasets:[]},options:{color:_,borderColor:v,responsive:!0,scales:{y:{ticks:{color:_},beginAtZero:!0,suggestedMax:100,suggestedMin:0,grid:{color:v}},x:{ticks:{color:_},grid:{color:v}}},plugins:{datalabels:{anchor:"end",align:"end",offset:2,color:_}}}})}),O(()=>g.data,()=>{r!==void 0&&(r.data.datasets=g.data,r.update("active"))}),(_,v)=>(A(),x("canvas",{ref_key:"chartDOMElement",ref:i},null,512))}});const l=w=>(re("data-v-010eed33"),w=w(),de(),w),_e={class:"container"},ve={class:"row"},he={class:"col-6"},me={class:"mb-4"},be=l(()=>e("h2",{class:"text-center"},"Scegli un attaccante",-1)),ge={class:"mb-4"},fe=l(()=>e("h2",null,"Dettagli personaggio",-1)),De=l(()=>e("span",{class:"h4"},"Nome:",-1)),ke=b(),Ce={class:"ps-3"},Ae=l(()=>e("span",{class:"h4"},"Armatura:",-1)),xe=b(),ye={class:"ps-3"},Ve=l(()=>e("span",{class:"h4"},"Competenza Attacco:",-1)),ze=b(),we={class:"ps-3"},Me=l(()=>e("span",{class:"h4"},"Competenza Difesa:",-1)),Pe=b(),Ee={class:"ps-3"},Fe=l(()=>e("span",{class:"h4"},"Resistenza al danno:",-1)),Se={class:"ps-3"},Re=l(()=>e("span",{class:"h4"},"Armi:",-1)),We={key:0},Ne={key:1},Ie={class:"form-check"},Ue=l(()=>e("label",{class:"form-check-label",for:"attackerAllWeaponsCheckbox"},"Mostra tutte le armi",-1)),Be={class:"row justify-content-center"},je={class:"col-sm-10 col-md-10 col-lg-8 col-xl-8 col-xxl-8"},Le=l(()=>e("hr",null,null,-1)),Oe={class:"mt-4"},$e={class:"row"},Je={class:"col-6"},Te={class:"mb-4"},Ze=l(()=>e("h2",{class:"text-center"},"Scegli un difensore",-1)),qe=l(()=>e("h2",null,"Dettagli personaggio",-1)),Ge=l(()=>e("span",{class:"h4"},"Nome:",-1)),He=b(),Ke={class:"ps-3"},Qe=l(()=>e("span",{class:"h4"},"Armatura:",-1)),Xe=b(),Ye={class:"ps-3"},et=l(()=>e("span",{class:"h4"},"Competenza Attacco:",-1)),tt=b(),at={class:"ps-3"},ot=l(()=>e("span",{class:"h4"},"Competenza Difesa:",-1)),st=b(),lt={class:"ps-3"},nt=l(()=>e("span",{class:"h4"},"Resistenza al danno:",-1)),ct={class:"ps-3"},it=l(()=>e("span",{class:"h4"},"Copertura:",-1)),rt=["value"],dt={class:"form-check-label"},ut={class:"row justify-content-center"},pt={class:"col-sm-10 col-md-10 col-lg-8 col-xl-8 col-xxl-8"},_t={class:"mt-4"},vt=l(()=>e("hr",null,null,-1)),ht={class:"text-center"},mt=b("Danno Medio: "),bt={class:"table table-dark table-striped mt-2",id:"tabDanni"},gt=l(()=>e("thead",null,[e("tr",null,[e("th",null,"Risultato dadi"),e("th",null,"Danno effettivo"),e("th",null,"Probabilit\xE0")])],-1)),ft=H({__name:"CalculatorView",setup(w){const g=m(void 0),i=m(null),r=m(null),_=m(!1),v=ne();O(()=>v.isDataLoaded,$),K($);function $(){N.value=v.getArmi,I.value=v.getPersonaggi,U.value=v.getArmature}const N=m([]),I=m([]),U=m([]),B=z(()=>{if(i.value==null)return[];if(_.value)return N.value;const a=[];return i.value.armi.forEach(s=>{const p=N.value.find(h=>h.codice==s.arma);p!==void 0&&a.push(p)}),a}),u=m(null);O(i,()=>{u.value=B.value[0]});function Q(a,s,p,h){var f,D,k;const M=[.7,.7375,.775,.8125,.85,.8875,.925,.9625],y=U.value.find(t=>t.codice==p.armatura);if(!y)throw`Armatura difensore non trovata ${p.armatura}`;const P=a.tipoDanno,E=a.gravitaDanno,F=(k=(D=(f=y.gravitaDanno)==null?void 0:f[E])==null?void 0:D[P][0])!=null?k:0,V=new Array(30);for(let t=0;t<30;t++)t<8&&a.tipoDanno=="perforante"?V[t]=Math.round(a.probabilita[t]*(100+5*(s.competenzaAttacco-p.competenzaDifesa)-F*M[t]-h)/100):V[t]=Math.round(a.probabilita[t]*(100+5*(s.competenzaAttacco-p.competenzaDifesa)-F-h)/100);return V.map(X)}const X=a=>Math.min(99,Math.max(1,a)),Y=z(()=>{var a;return(a=u.value)==null?void 0:a.probabilita}),ee=z(()=>{var a;return[{label:"Probabilit\xE0 di colpire base dell'arma",data:(a=Y.value)!=null?a:[],backgroundColor:["rgba(54, 162, 235, 0.8)"],borderColor:["rgba(54, 162, 235, 1)"],borderWidth:1}]}),te=z(()=>{if(u.value!==null&&i.value!==null&&r.value!==null&&g.value!==void 0)return Q(u.value,i.value,r.value,g.value)}),j=z(()=>{var f,D,k;if(u.value===null)return[];if(i.value===null)return[];if(r.value===null)return[];if(g.value===void 0)return[];const a=r.value.armatura,s=U.value.find(t=>t.codice==a);u.value.danno.reduce((t,n)=>t+n,0);const p=u.value.danno.length,h=u.value.danno.reduce((t,n)=>t*n,1),M=u.value.tipoDanno,y=u.value.gravitaDanno,P=(k=(D=(f=s==null?void 0:s.gravitaDanno)==null?void 0:f[y])==null?void 0:D[M][0])!=null?k:0,E=(t,n)=>t.length>n.length?t.map((c,o)=>o<n.length?t[o]+n[o]:t[o]):n.map((c,o)=>o<t.length?t[o]+n[o]:n[o]);return(t=>t.reduce((n,c)=>n.reduceRight((o,S)=>[0,...E(Array(c).fill(S),o)],[]),[1]))(u.value.danno).map(t=>t/h*100).map((t,n)=>({diceResult:n,probability:t})).filter(t=>t.probability>0).map((t,n)=>{var o,S,J,T;const c=Math.max(0,(n+p)*(100-P)/100-((T=(J=(S=(o=r.value)==null?void 0:o.statistiche)==null?void 0:S.ossatura)==null?void 0:J[1])!=null?T:0));return{probability:t,effectiveDamage:c}})}),ae=z(()=>j.value.map(a=>a.effectiveDamage*a.probability.probability/100).reduce((a,s)=>a+s,0)),oe=z(()=>{var a;return[{label:"Probabilit\xE0 di colpire",data:(a=te.value)!=null?a:[],backgroundColor:["rgba(54, 162, 235, 0.8)"],borderColor:["rgba(54, 162, 235, 1)"],borderWidth:1}]});return(a,s)=>{var h,M,y,P,E,F,V,f,D,k,t,n;const p=ce("v-select");return A(),x("div",_e,[e("div",ve,[e("div",null,[e("div",he,[e("div",me,[be,R(p,{options:I.value,label:"nome",modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=c=>i.value=c)},null,8,["options","modelValue"])]),W(e("div",ge,[fe,e("div",null,[De,ke,e("span",Ce,d((h=i.value)==null?void 0:h.nome),1)]),e("div",null,[Ae,xe,e("span",ye,d((M=i.value)==null?void 0:M.armatura),1)]),e("div",null,[Ve,ze,e("span",we,d((y=i.value)==null?void 0:y.competenzaAttacco),1)]),e("div",null,[Me,Pe,e("span",Ee,d((P=i.value)==null?void 0:P.competenzaDifesa),1)]),e("div",null,[Fe,e("span",Se,d((F=(E=i.value)==null?void 0:E.resistenzaAlDanno)!=null?F:0),1)]),e("div",null,[Re,C(B).length===0?(A(),x("div",We,"Il personaggio non ha armi")):(A(),x("div",Ne,[R(p,{options:C(B),label:"nome",modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=c=>u.value=c)},null,8,["options","modelValue"])])),e("div",Ie,[W(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"attackerAllWeaponsCheckbox","onUpdate:modelValue":s[2]||(s[2]=c=>_.value=c)},null,512),[[ie,_.value]]),Ue])])],512),[[L,i.value]])])]),e("div",Be,[e("div",je,[R(G,{data:C(ee)},null,8,["data"])])])]),Le,e("div",Oe,[e("div",$e,[e("div",Je,[e("div",Te,[Ze,R(p,{options:I.value,label:"nome",modelValue:r.value,"onUpdate:modelValue":s[3]||(s[3]=c=>r.value=c)},null,8,["options","modelValue"])]),W(e("div",null,[qe,e("div",null,[Ge,He,e("span",Ke,d((V=r.value)==null?void 0:V.nome),1)]),e("div",null,[Qe,Xe,e("span",Ye,d((f=r.value)==null?void 0:f.armatura),1)]),e("div",null,[et,tt,e("span",at,d((D=r.value)==null?void 0:D.competenzaAttacco),1)]),e("div",null,[ot,st,e("span",lt,d((k=r.value)==null?void 0:k.competenzaDifesa),1)]),e("div",null,[nt,e("span",ct,d((n=(t=r.value)==null?void 0:t.resistenzaAlDanno)!=null?n:0),1)]),e("div",null,[it,e("div",null,[(A(!0),x(Z,null,q(C(pe),(c,o)=>(A(),x("div",{class:"form-check",key:o},[W(e("input",{class:"form-check-input",type:"radio",value:c,"onUpdate:modelValue":s[4]||(s[4]=S=>g.value=S)},null,8,rt),[[ue,g.value]]),e("label",dt,d(o==="pesante"?"Copertura pesante":o==="nessuna"?"Nessuna copertura":o==="leggera"?"Leggera copertura":o==="alta"?"Alta esposizione":""),1)]))),128))])])],512),[[L,r.value]])])]),e("div",ut,[e("div",pt,[R(G,{data:C(oe)},null,8,["data"])])])]),W(e("div",_t,[vt,e("h2",ht,[mt,e("strong",null,d(parseFloat(C(ae).toFixed(2))),1)]),e("table",bt,[gt,e("tbody",null,[(A(!0),x(Z,null,q(C(j),(c,o)=>(A(),x("tr",{key:o},[e("td",null,d(parseFloat(c.probability.diceResult.toFixed(2))),1),e("td",null,d(parseFloat(c.effectiveDamage.toFixed(2))),1),e("td",null,d(parseFloat(c.probability.probability.toFixed(2)))+" %",1)]))),128))])])],512),[[L,C(j).length>0]])])}}});var kt=le(ft,[["__scopeId","data-v-010eed33"]]);export{kt as default};
